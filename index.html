<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="color-scheme" content="dark light">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="styles.css"/>
	<title>Solar Jumper</title>
	<script type="module">
		
		import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
		import { Observable, BehaviorSubject, fromEvent } from 'https://cdn.jsdelivr.net/npm/rxjs@7.8.0/+esm'
		import { generate_celestial_monikers } from "https://unpkg.com/celestial-moniker-generator/src/index.js"
		
		import { initializeSystem, updateOrbits } from "./planets.js"

		const randomNumber = d3.randomInt(4, 12)
		
		const list = d3.select('#the-list');

		const width = 400, height = 400
		const margin = { top: 50, right: 80, bottom: 50, left: 50 }
		
		const system = d3.select("#the-orbits")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
			.append("g")
			.attr(
				"transform", `translate(${width / 2 + margin.left}, ${height / 2 + margin.top})`
			);

		initializeSystem(system)
		
		function updateList(planets) {
			const items = list.selectAll('li')
			.data(planets);
			
			items.enter().append('li')
			.text(d => d)
			.merge(items)
			.text(d => d);
			
			items.exit().remove();
		}
		
		const button = document.querySelector('#the-button');
		const buttonClickObservable = fromEvent(button, 'click');
		buttonClickObservable.subscribe(event => {
			const newPlanetNames = generate_celestial_monikers(randomNumber())
			planetNamesSubject.next(newPlanetNames);
		});
		
		const planetNamesSubject = new BehaviorSubject([]);
		const planetNamesObservable = planetNamesSubject.asObservable();
		planetNamesObservable.subscribe(planets => {
			updateList(planets);
			updateOrbits(system, planets);
		});	
		
		// start the warping!
		const newPlanetNames = generate_celestial_monikers(randomNumber())
		planetNamesSubject.next(newPlanetNames)
		
	</script>
</head>
<body>
	<div class="container">
		<div class="left">
			<button id="the-button">Warp To Another System</button><br />
			<ul id="the-list"></ul>
		</div>
		<div class="right">
			<svg id="the-orbits"></svg>
		</div>
	</div>
</body>
</html>